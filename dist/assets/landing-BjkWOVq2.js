import"./modulepreload-polyfill-B5Qt9EMX.js";/* empty css              */import{initializeApp as b}from"https://www.gstatic.com/firebasejs/10.6.0/firebase-app.js";import{getFirestore as w,setDoc as L,doc as c,Timestamp as A,getDoc as C,onSnapshot as N}from"https://www.gstatic.com/firebasejs/10.6.0/firebase-firestore.js";import{getAuth as D,onAuthStateChanged as j}from"https://www.gstatic.com/firebasejs/10.6.0/firebase-auth.js";import{l as k}from"./logout-Bf75CsCK.js";import"./firebaseConfig-xSN_xHYb.js";import"https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js";import"https://www.gstatic.com/firebasejs/10.13.1/firebase-auth.js";import"https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore.js";import"https://www.gstatic.com/firebasejs/10.13.1/firebase-storage.js";const v={apiKey:"AIzaSyDD_2z29qDHPVXeSXyZ0T9VO_n_PcW1EqU",authDomain:"group-project-8a6ee.firebaseapp.com",projectId:"group-project-8a6ee",storageBucket:"group-project-8a6ee.firebasestorage.app",messagingSenderId:"922685674876",appId:"1:922685674876:web:6edeac0ff4fb485db780f9",measurementId:"G-1LCVJ62HEL"},d=b(v),p=w(d),E=D(d);let s=null,l=null;const i=new maplibregl.Map({container:"map",style:"https://api.maptiler.com/maps/019a5278-dbf9-77ba-8b85-d04e6ac21b57/style.json?key=tdthCswjV8GNYleNLj1C",center:[-123.0016,49.2532],zoom:13,pitch:0,bearing:0});i.dragRotate.enable();i.touchZoomRotate.enableRotation();i.addControl(new maplibregl.NavigationControl({visualizePitch:!0,showCompass:!0,showZoom:!0}));const f=new maplibregl.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0,showUserHeading:!0});i.addControl(f);i.on("load",()=>f.trigger());async function P(e){if(!s){console.warn("No logged-in user yet, skipping location update.");return}const o=e.coords.latitude,r=e.coords.longitude;try{await L(c(p,"locations",s),{lat:o,lng:r,updatedAt:A.now(),displayName:l},{merge:!0}),console.log("Updated my location in Firestore:",o,r)}catch(t){console.error("Error updating location:",t)}}const n={};function T(e,o,r=!1){if(!o||o.lat==null||o.lng==null)return;const t=(r?"(You) ":"")+(o.displayName||o.userDisplayName||e);if(n[e]){n[e].setLngLat([o.lng,o.lat]);const g=n[e].getPopup();g&&g.setText(t);return}const y="./images/otherpin.png",a=document.createElement("img");a.src=y,a.alt=t,a.style.width="40px",a.style.height="40px",a.style.borderRadius="50%",a.style.objectFit="cover";const h=new maplibregl.Popup({offset:25}).setText(t);n[e]=new maplibregl.Marker({element:a}).setLngLat([o.lng,o.lat]).setPopup(h).addTo(i),n[e].togglePopup()}function m(e,o=!1){const r=c(p,"locations",e);N(r,t=>{if(!t.exists()){n[e]&&(n[e].remove(),delete n[e]);return}T(e,t.data(),o)},t=>{console.error("Location listener error for",e,t)})}async function x(){if(s)try{const e=c(p,"users",s),o=await C(e);let r=[];if(o.exists()){const t=o.data();r=Array.isArray(t.friends)?t.friends:[]}m(s,!0),r.forEach(t=>{m(t,!1)}),console.log("Started location listeners for friends:",r)}catch(e){console.error("Error starting friends listeners:",e)}}j(E,e=>{e?(s=e.uid,l=e.displayName||e.email||"Anonymous",console.log("Logged in as:",s,l),"geolocation"in navigator?navigator.geolocation.watchPosition(P,o=>console.error("Geolocation error:",o),{enableHighAccuracy:!0}):console.error("Geolocation is not supported on this device."),x()):(console.log("No user logged in. Redirecting to login..."),window.location.href="login.html")});const u=document.getElementById("logoutBtn");u&&u.addEventListener("click",k);
